graph TD
    A[消息队列] -->|接收任务| B(ScanService)
    B -->|解析任务| C[ScannerFactory]
    C -->|获取执行器| D{TaskExecutor}
    D -->|容器执行器| E[ContainerExecutor]
    E -->|启动容器| F[Docker容器]
    F -->|执行扫描| G[扫描进程]
    G -->|返回结果| H[结果队列]

    subgraph 资源管理
        E -->|资源配额| I[CPU/内存限制]
        E -->|安全配置| J[安全策略]
    end

    subgraph 监控与指标
        K[TimeoutController] -->|监控超时| E
        L[MetricsCollector] -->|收集指标| M[Prometheus]
        N[CircuitBreaker] -->|熔断保护| C
        O[WatchdogService] -->|心跳检测| D
    end

    subgraph 错误处理
        P[错误发生] -->|记录错误| L
        P -->|触发熔断| N
        P -->|重试策略| C
    end

    A -->|任务消息| B
    H -->|结果存储| Q[(数据库)]

    style A fill:#f9f,stroke:#333
    style B fill:#c6e2ff,stroke:#333
    style C fill:#ffd700,stroke:#333
    style D fill:#98fb98,stroke:#333
    style H fill:#ffb6c1,stroke:#333